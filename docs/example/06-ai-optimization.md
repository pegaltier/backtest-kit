# AI –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É Optimizer –≤ backtest-kit –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å –ø–æ–º–æ—â—å—é –±–æ–ª—å—à–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (LLM). –í—ã —É–∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Ollama, —Å–æ–∑–¥–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.

## –ß—Ç–æ —Ç–∞–∫–æ–µ Optimizer?

Optimizer - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –º–µ—Ç–∞-—É—Ä–æ–≤–Ω—è, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ä–µ–∂–∏–º–æ–≤ Backtest, Live –∏ Walker, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª–Ω—è—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, Optimizer —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—è –¥–∞–Ω–Ω—ã–µ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—è –∫–æ–¥.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ü§ñ **LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Ollama –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- üìä **–ú—É–ª—å—Ç–∏–∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö** - –°–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- üìÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã** - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
- üîÑ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Walker** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- üíæ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –∫–æ–¥** - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –∫ –∑–∞–ø—É—Å–∫—É `.mjs` —Ñ–∞–π–ª—ã

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ollama

**Windows:**
```bash
# –°–∫–∞—á–∞–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞
https://ollama.ai/download/windows

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ winget
winget install Ollama.Ollama
```

**macOS:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Homebrew
brew install ollama
```

**Linux:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ curl
curl -fsSL https://ollama.ai/install.sh | sh
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Ollama —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
ollama serve

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–æ–¥–µ–ª—å deepseek-v3.1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π)
ollama pull deepseek-v3.1

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏
ollama pull llama3
ollama pull mistral
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–æ–¥–µ–ª—å
ollama run deepseek-v3.1
>>> –ü—Ä–∏–≤–µ—Ç, —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å?
>>> (Ctrl+D –¥–ª—è –≤—ã—Ö–æ–¥–∞)
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í .env —Ñ–∞–π–ª–µ
OLLAMA_HOST=http://localhost:11434
OLLAMA_MODEL=deepseek-v3.1
```

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã Optimizer

```mermaid
graph TB
    subgraph "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
        AddOpt[addOptimizer]
        Schema[IOptimizerSchema]
    end

    subgraph "–ü—É–±–ª–∏—á–Ω—ã–π API"
        OptimizerUtils[Optimizer.getData<br/>Optimizer.getCode<br/>Optimizer.dump]
    end

    subgraph "–°–ª–æ–∏ —Å–µ—Ä–≤–∏—Å–æ–≤"
        Global[OptimizerGlobalService<br/>–æ–±–µ—Ä—Ç–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏]
        Connection[OptimizerConnectionService<br/>—Å–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤]
        Client[ClientOptimizer<br/>–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞]
    end

    subgraph "–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö"
        Sources[IOptimizerSource<br/>—Ñ—É–Ω–∫—Ü–∏–∏ fetch]
        Pagination[RESOLVE_PAGINATION_FN<br/>iterateDocuments]
        Messages[MessageModel –º–∞—Å—Å–∏–≤<br/>–∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞]
    end

    subgraph "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞"
        Template[OptimizerTemplateService<br/>11 –º–µ—Ç–æ–¥–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤]
        Prompt[getPrompt<br/>–ª–æ–≥–∏–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏]
        Code[–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π .mjs —Ñ–∞–π–ª]
    end

    subgraph "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"
        Walker[–°–∏—Å—Ç–µ–º–∞ Walker<br/>—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π]
        Backtest[–°–∏—Å—Ç–µ–º–∞ Backtest<br/>–≤–∞–ª–∏–¥–∞—Ü–∏—è]
    end

    AddOpt --> Schema
    Schema --> OptimizerUtils
    OptimizerUtils --> Global
    Global --> Connection
    Connection --> Client

    Client --> Sources
    Sources --> Pagination
    Pagination --> Messages
    Messages --> Prompt

    Prompt --> Template
    Template --> Code

    Code -.->|–∏—Å–ø–æ–ª–Ω—è–µ—Ç| Walker
    Walker -.->|–∏—Å–ø–æ–ª—å–∑—É–µ—Ç| Backtest
```

---

## –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞

### –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```typescript
import { addOptimizer } from "backtest-kit";

addOptimizer({
  optimizerName: "crypto-optimizer",
  note: "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç",

  // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
  rangeTrain: [
    {
      startDate: new Date("2025-01-01"),
      endDate: new Date("2025-01-15"),
    },
    {
      startDate: new Date("2025-02-01"),
      endDate: new Date("2025-02-15"),
    },
  ],

  // –í—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  rangeTest: {
    startDate: new Date("2025-03-01"),
    endDate: new Date("2025-03-15"),
  },

  // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
  source: [
    // –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–¥–µ—Å—å
  ],

  // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞
  getPrompt: async (symbol, messages) => {
    // –õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞ –∑–¥–µ—Å—å
  },
});
```

---

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ–±—É—á–µ–Ω–∏—è LLM.

### –ü—Ä–∏–º–µ—Ä 1: –ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–æ–≤–æ—Å—Ç–µ–π

```typescript
import { addOptimizer } from "backtest-kit";

addOptimizer({
  optimizerName: "news-based-optimizer",
  rangeTrain: [
    {
      startDate: new Date("2025-01-01"),
      endDate: new Date("2025-01-31"),
    },
  ],
  rangeTest: {
    startDate: new Date("2025-02-01"),
    endDate: new Date("2025-02-28"),
  },

  // –ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–æ–≤–æ—Å—Ç–µ–π
  source: [
    {
      name: "crypto-news",
      fetch: async ({ symbol, startDate, endDate, limit, offset }) => {
        // –í—ã–∑–æ–≤ API –Ω–æ–≤–æ—Å—Ç–µ–π
        const response = await fetch(
          `https://api.cryptonews.com/v1/news?` +
          `symbol=${symbol}&` +
          `start=${startDate.getTime()}&` +
          `end=${endDate.getTime()}&` +
          `limit=${limit}&` +
          `offset=${offset}`
        );

        const news = await response.json();

        return news.articles.map(article => ({
          id: article.id,
          title: article.title,
          content: article.content,
          timestamp: article.publishedAt,
          sentiment: article.sentiment,
        }));
      },

      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
      user: async (symbol, data, sourceName) => {
        return `–í–æ—Ç –Ω–æ–≤–æ—Å—Ç–∏ –æ ${symbol}:\n\n` +
          data.map(article =>
            `[${new Date(article.timestamp).toISOString()}] ${article.title}\n` +
            `–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${article.sentiment}\n` +
            `${article.content.substring(0, 200)}...\n`
          ).join('\n');
      },

      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
      assistant: async (symbol, data, sourceName) => {
        const positiveSentiment = data.filter(a => a.sentiment > 0).length;
        const negativeSentiment = data.filter(a => a.sentiment < 0).length;

        return `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª ${data.length} –Ω–æ–≤–æ—Å—Ç–µ–π –æ ${symbol}.\n` +
          `–ü–æ–∑–∏—Ç–∏–≤–Ω—ã—Ö: ${positiveSentiment}, –ù–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö: ${negativeSentiment}.\n` +
          `–û–±—â–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: ${positiveSentiment > negativeSentiment ? '–±—ã—á—å–µ' : '–º–µ–¥–≤–µ–∂—å–µ'}.`;
      },
    },
  ],

  getPrompt: async (symbol, messages) => {
    return `–ù–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π, —Å–æ–∑–¥–∞–π —Ç–æ—Ä–≥–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è ${symbol}.`;
  },
});
```

### –ü—Ä–∏–º–µ—Ä 2: –ò—Å—Ç–æ—á–Ω–∏–∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

```typescript
import { SMA, RSI, MACD } from "technicalindicators";
import { addOptimizer } from "backtest-kit";

addOptimizer({
  optimizerName: "technical-optimizer",
  rangeTrain: [
    {
      startDate: new Date("2025-01-01"),
      endDate: new Date("2025-01-31"),
    },
  ],
  rangeTest: {
    startDate: new Date("2025-02-01"),
    endDate: new Date("2025-02-28"),
  },

  source: [
    {
      name: "technical-indicators",
      fetch: async ({ symbol, startDate, endDate, limit, offset }) => {
        // –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–≤–µ—á–∏
        const exchange = new ccxt.binance();
        const ohlcv = await exchange.fetchOHLCV(
          symbol,
          "1h",
          startDate.getTime(),
          100
        );

        const closes = ohlcv.map(c => c[4]);

        // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
        const sma20 = SMA.calculate({ period: 20, values: closes });
        const sma50 = SMA.calculate({ period: 50, values: closes });
        const rsi = RSI.calculate({ period: 14, values: closes });
        const macd = MACD.calculate({
          values: closes,
          fastPeriod: 12,
          slowPeriod: 26,
          signalPeriod: 9,
          SimpleMAOscillator: false,
          SimpleMASignal: false,
        });

        return [{
          id: `${symbol}-${startDate.getTime()}`,
          symbol,
          timestamp: Date.now(),
          indicators: {
            sma20: sma20[sma20.length - 1],
            sma50: sma50[sma50.length - 1],
            rsi: rsi[rsi.length - 1],
            macd: macd[macd.length - 1],
          },
          candles: ohlcv.slice(-24),
        }];
      },

      user: async (symbol, data, sourceName) => {
        const latest = data[data.length - 1];
        return `–¢–µ–∫—É—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–ª—è ${symbol}:\n` +
          `SMA(20): ${latest.indicators.sma20?.toFixed(2)}\n` +
          `SMA(50): ${latest.indicators.sma50?.toFixed(2)}\n` +
          `RSI(14): ${latest.indicators.rsi?.toFixed(2)}\n` +
          `MACD: ${latest.indicators.macd?.MACD?.toFixed(2)}\n` +
          `Signal: ${latest.indicators.macd?.signal?.toFixed(2)}`;
      },

      assistant: async (symbol, data, sourceName) => {
        const latest = data[data.length - 1];
        const trend = latest.indicators.sma20 > latest.indicators.sma50 ? "–≤–æ—Å—Ö–æ–¥—è—â–∏–π" : "–Ω–∏—Å—Ö–æ–¥—è—â–∏–π";
        const rsiStatus = latest.indicators.rsi > 70 ? "–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω" : latest.indicators.rsi < 30 ? "–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω" : "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π";

        return `–ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤:\n–¢—Ä–µ–Ω–¥: ${trend}\nRSI: ${rsiStatus}`;
      },
    },
  ],

  getPrompt: async (symbol, messages) => {
    return `–ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, —Å–æ–∑–¥–∞–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ ${symbol}.` +
      `–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–±–∏–Ω–∞—Ü–∏—é SMA –∫—Ä–æ—Å—Å–æ–≤–µ—Ä–æ–≤, RSI –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏/–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏,` +
      `–∏ MACD –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–∞.`;
  },
});
```

---

## –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–∞

–§—É–Ω–∫—Ü–∏—è `getPrompt` –ø–æ–ª—É—á–∞–µ—Ç –≤—Å—é —Å–æ–±—Ä–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Å–æ–∑–¥–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è LLM.

```typescript
import { addOptimizer } from "backtest-kit";
import { Ollama } from "ollama";

addOptimizer({
  optimizerName: "advanced-optimizer",
  rangeTrain: [/* ... */],
  rangeTest: {/* ... */},
  source: [/* ... */],

  getPrompt: async (symbol, messages) => {
    // messages - –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

    // –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞
    const ollama = new Ollama({ host: process.env.OLLAMA_HOST });

    const summaryResponse = await ollama.chat({
      model: process.env.OLLAMA_MODEL || "deepseek-v3.1",
      messages: [
        {
          role: "user",
          content: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä—ã–Ω–∫–µ –∏ —Å–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ:\n\n" +
            messages.map(m => `${m.role}: ${m.content}`).join('\n\n')
        },
      ],
    });

    const summary = summaryResponse.message.content;

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    return `–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ.

–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞:
${summary}

–°–æ–∑–¥–∞–π —Ç–æ—Ä–≥–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è ${symbol} —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏:

1. –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï –í–•–û–î–ê: –û–ø—Ä–µ–¥–µ–ª–∏, –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å LONG –∏–ª–∏ SHORT –ø–æ–∑–∏—Ü–∏–∏
2. –¢–û–ß–ö–ê –í–•–û–î–ê: –û–ø—Ä–µ–¥–µ–ª–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–π priceOpen –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –≤—Ö–æ–¥)
3. –¢–ï–ô–ö-–ü–†–û–§–ò–¢: –¶–µ–ª–µ–≤–∞—è —Ü–µ–Ω–∞ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø—Ä–∏–±—ã–ª–∏ (–º–∏–Ω–∏–º—É–º +2% –æ—Ç –≤—Ö–æ–¥–∞)
4. –°–¢–û–ü-–õ–û–°–°: –ó–∞—â–∏—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (–º–∞–∫—Å–∏–º—É–º -1.5% –æ—Ç –≤—Ö–æ–¥–∞)
5. –í–†–ï–ú–Ø –ñ–ò–ó–ù–ò: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö

–í–ê–ñ–ù–û: –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫/–ø—Ä–∏–±—ã–ª—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 1:2.

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{
  "position": "long" | "short" | "wait",
  "priceOpen": number | undefined,
  "priceTakeProfit": number,
  "priceStopLoss": number,
  "minuteEstimatedTime": number
}

–ï—Å–ª–∏ –Ω–µ—Ç —á–µ—Ç–∫–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞, –∏—Å–ø–æ–ª—å–∑—É–π "position": "wait".`;
  },
});
```

---

## –ó–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ú–µ—Ç–æ–¥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```typescript
import { Optimizer } from "backtest-kit";

// –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
const strategies = await Optimizer.getData("BTCUSDT", {
  optimizerName: "crypto-optimizer",
});

console.log(`–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π: ${strategies.length}`);

strategies.forEach((strategy, index) => {
  console.log(`\n–°—Ç—Ä–∞—Ç–µ–≥–∏—è ${index + 1}:`);
  console.log(`  –ù–∞–∑–≤–∞–Ω–∏–µ: ${strategy.name}`);
  console.log(`  –°–∏–º–≤–æ–ª: ${strategy.symbol}`);
  console.log(`  –ü—Ä–æ–º–ø—Ç:\n${strategy.strategy}`);
});
```

### –ú–µ—Ç–æ–¥ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞

```typescript
import { Optimizer } from "backtest-kit";

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ –∫–æ–¥–∞
const code = await Optimizer.getCode("BTCUSDT", {
  optimizerName: "crypto-optimizer",
});

console.log("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:");
console.log(code);

// –ö–æ–¥ –≤–∫–ª—é—á–∞–µ—Ç:
// - –ò–º–ø–æ—Ä—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
// - –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM
// - –ù–∞—Å—Ç—Ä–æ–π–∫—É –±–∏—Ä–∂–∏
// - –§—Ä–µ–π–º—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
// - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
// - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Walker –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
// - –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –∏ –∑–∞–ø—É—Å–∫
```

### –ú–µ—Ç–æ–¥ 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª

```typescript
import { Optimizer, listenOptimizerProgress } from "backtest-kit";

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
listenOptimizerProgress((event) => {
  const percent = (event.progress * 100).toFixed(1);
  console.log(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${percent}% - ${event.comment}`);
});

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ —Ñ–∞–π–ª
await Optimizer.dump("BTCUSDT", {
  optimizerName: "crypto-optimizer",
});

// –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: ./dump/optimizer/crypto-optimizer_BTCUSDT.mjs
console.log("–ö–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ ./dump/optimizer/crypto-optimizer_BTCUSDT.mjs");

// –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:
// node ./dump/optimizer/crypto-optimizer_BTCUSDT.mjs
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

Optimizer –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã–π –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é `.mjs` —Ñ–∞–π–ª —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```javascript
#!/usr/bin/env node

// 1. –ò–º–ø–æ—Ä—Ç—ã
import { Ollama } from "ollama";
import ccxt from "ccxt";
import {
  addExchange,
  addFrame,
  addStrategy,
  addWalker,
  Walker,
  listenWalkerProgress,
  listenDoneWalker,
} from "backtest-kit";

// 2. –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
const OLLAMA_HOST = process.env.OLLAMA_HOST || "http://localhost:11434";
const OLLAMA_MODEL = process.env.OLLAMA_MODEL || "deepseek-v3.1";
const ollama = new Ollama({ host: OLLAMA_HOST });

// 3. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM
async function text(messages) { /* ... */ }
async function json(messages) { /* ... */ }
async function dumpJson(resultId, history, result) { /* ... */ }

// 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∏—Ä–∂–∏
addExchange({
  exchangeName: "a7x3k_exchange",
  getCandles: async (symbol, interval, since, limit) => { /* ... */ },
  formatPrice: async (symbol, price) => { /* ... */ },
  formatQuantity: async (symbol, quantity) => { /* ... */ },
});

// 5. –§—Ä–µ–π–º—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
addFrame({
  frameName: "a7x3k_train_frame-1",
  interval: "5m",
  startDate: new Date("2025-01-01"),
  endDate: new Date("2025-01-15"),
});

addFrame({
  frameName: "a7x3k_train_frame-2",
  interval: "5m",
  startDate: new Date("2025-02-01"),
  endDate: new Date("2025-02-15"),
});

// 6. –§—Ä–µ–π–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
addFrame({
  frameName: "a7x3k_test_frame",
  interval: "5m",
  startDate: new Date("2025-03-01"),
  endDate: new Date("2025-03-15"),
});

// 7. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
addStrategy({
  strategyName: "a7x3k_strategy-1",
  interval: "5m",
  getSignal: async (symbol) => {
    // –ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
    const messages = [];

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ—á–µ–π —Ä–∞–∑–Ω—ã—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
    const microTermCandles = await getCandles(symbol, "1m", 30);
    const mainTermCandles = await getCandles(symbol, "5m", 24);
    const shortTermCandles = await getCandles(symbol, "15m", 24);
    const mediumTermCandles = await getCandles(symbol, "1h", 24);

    // –ê–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–≥–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞
    messages.push(
      { role: "user", content: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–≤–µ—á–∏ 1h..." },
      { role: "assistant", content: "–¢—Ä–µ–Ω–¥ 1h –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω" }
    );

    // ... –∞–Ω–∞–ª–∏–∑ –¥—Ä—É–≥–∏—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤ ...

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
    messages.push({
      role: "user",
      content: "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ç–æ—Ä–≥–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª: " + strategyPrompt
    });

    const result = await json(messages);
    await dumpJson("strategy-1", messages, result);

    return result;
  },
});

// 8. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Walker –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
addWalker({
  walkerName: "a7x3k_walker",
  exchangeName: "a7x3k_exchange",
  frameName: "a7x3k_test_frame",
  strategies: [
    { strategyName: "a7x3k_strategy-1", symbols: ["BTCUSDT"] },
    { strategyName: "a7x3k_strategy-2", symbols: ["BTCUSDT"] },
  ],
});

// 9. –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π –∏ –∑–∞–ø—É—Å–∫
listenWalkerProgress((event) => {
  console.log(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${(event.progress * 100).toFixed(1)}%`);
});

listenDoneWalker(async (event) => {
  console.log("–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ");
  await Walker.dump(event.symbol, event.walkerName);
});

// –ó–∞–ø—É—Å–∫ Walker
Walker.background("BTCUSDT", {
  walkerName: "a7x3k_walker",
});
```

---

## –ú—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç 4-—Ñ–∞–∑–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –∞–Ω–∞–ª–∏–∑–∞:

```mermaid
graph LR
    subgraph "–§–∞–∑–∞ 1: –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–π"
        M1h[–ê–Ω–∞–ª–∏–∑ —Å–≤–µ—á–µ–π 1h<br/>24 —Å–≤–µ—á–∏]
    end

    subgraph "–§–∞–∑–∞ 2: –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–π"
        M15m[–ê–Ω–∞–ª–∏–∑ —Å–≤–µ—á–µ–π 15m<br/>24 —Å–≤–µ—á–∏]
    end

    subgraph "–§–∞–∑–∞ 3: –û—Å–Ω–æ–≤–Ω–æ–π"
        M5m[–ê–Ω–∞–ª–∏–∑ —Å–≤–µ—á–µ–π 5m<br/>24 —Å–≤–µ—á–∏]
    end

    subgraph "–§–∞–∑–∞ 4: –ú–∏–∫—Ä–æ"
        M1m[–ê–Ω–∞–ª–∏–∑ —Å–≤–µ—á–µ–π 1m<br/>30 —Å–≤–µ—á–µ–π]
    end

    subgraph "–§–∞–∑–∞ 5: –°–∏–≥–Ω–∞–ª"
        Prompt[–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏<br/>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞]
    end

    M1h --> M15m
    M15m --> M5m
    M5m --> M1m
    M1m --> Prompt

    Prompt --> Signal[position: wait/long/short<br/>priceOpen, priceTakeProfit<br/>priceStopLoss, minuteEstimatedTime]
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```typescript
import { listenOptimizerProgress, Optimizer } from "backtest-kit";

// –î–µ—Ç–∞–ª—å–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
listenOptimizerProgress((event) => {
  console.log("\n=== –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ ===");
  console.log(`–°–∏–º–≤–æ–ª: ${event.symbol}`);
  console.log(`–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä: ${event.optimizerName}`);
  console.log(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${(event.progress * 100).toFixed(1)}%`);
  console.log(`–°—Ç–∞—Ç—É—Å: ${event.comment}`);
  console.log(`–í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞: ${new Date(event.timestamp).toISOString()}`);
});

// –ó–∞–ø—É—Å–∫ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
await Optimizer.dump("BTCUSDT", {
  optimizerName: "crypto-optimizer",
});
```

---

## –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä

```typescript
import { config } from "dotenv";
import ccxt from "ccxt";
import { Ollama } from "ollama";
import {
  setLogger,
  addOptimizer,
  Optimizer,
  listenOptimizerProgress,
} from "backtest-kit";

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
config();

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–≥–µ—Ä–∞
setLogger({
  log: console.log,
  debug: console.debug,
  info: console.info,
  warn: console.warn,
});

// –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞
addOptimizer({
  optimizerName: "advanced-crypto-optimizer",
  note: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö",

  rangeTrain: [
    {
      startDate: new Date("2025-01-01"),
      endDate: new Date("2025-01-15"),
    },
    {
      startDate: new Date("2025-01-16"),
      endDate: new Date("2025-01-31"),
    },
    {
      startDate: new Date("2025-02-01"),
      endDate: new Date("2025-02-15"),
    },
  ],

  rangeTest: {
    startDate: new Date("2025-03-01"),
    endDate: new Date("2025-03-31"),
  },

  source: [
    // –ò—Å—Ç–æ—á–Ω–∏–∫ 1: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    {
      name: "technical-analysis",
      fetch: async ({ symbol, startDate, endDate, limit, offset }) => {
        const exchange = new ccxt.binance();
        const ohlcv = await exchange.fetchOHLCV(
          symbol,
          "1h",
          startDate.getTime(),
          100
        );

        const closes = ohlcv.map(c => c[4]);

        return [{
          id: `tech-${symbol}-${startDate.getTime()}`,
          timestamp: Date.now(),
          candles: ohlcv,
          indicators: {
            // –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
            sma20: calculateSMA(closes, 20),
            rsi: calculateRSI(closes, 14),
            macd: calculateMACD(closes),
          },
        }];
      },
      user: async (symbol, data) => {
        return `–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ ${symbol}:\n${JSON.stringify(data[0].indicators, null, 2)}`;
      },
      assistant: async () => {
        return "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.";
      },
    },

    // –ò—Å—Ç–æ—á–Ω–∏–∫ 2: –û–±—ä–µ–º—ã —Ç–æ—Ä–≥–æ–≤
    {
      name: "volume-analysis",
      fetch: async ({ symbol, startDate, endDate }) => {
        const exchange = new ccxt.binance();
        const trades = await exchange.fetchTrades(symbol, startDate.getTime(), 1000);

        return [{
          id: `volume-${symbol}-${startDate.getTime()}`,
          totalVolume: trades.reduce((sum, t) => sum + t.amount, 0),
          avgPrice: trades.reduce((sum, t) => sum + t.price, 0) / trades.length,
          buyPressure: trades.filter(t => t.side === "buy").length / trades.length,
        }];
      },
      user: async (symbol, data) => {
        return `–ê–Ω–∞–ª–∏–∑ –æ–±—ä–µ–º–æ–≤ ${symbol}: –î–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π ${(data[0].buyPressure * 100).toFixed(1)}%`;
      },
      assistant: async () => {
        return "–ê–Ω–∞–ª–∏–∑ –æ–±—ä–µ–º–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω.";
      },
    },
  ],

  getPrompt: async (symbol, messages) => {
    const ollama = new Ollama({ host: process.env.OLLAMA_HOST });

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–≤–æ–¥–∫–∏ —Å –ø–æ–º–æ—â—å—é LLM
    const summaryResponse = await ollama.chat({
      model: "deepseek-v3.1",
      messages: [
        {
          role: "user",
          content: "–°–æ–∑–¥–∞–π –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É –∞–Ω–∞–ª–∏–∑–∞ —Ä—ã–Ω–∫–∞:\n\n" +
            messages.map(m => `${m.role}: ${m.content}`).join('\n\n')
        },
      ],
    });

    const summary = summaryResponse.message.content;

    return `–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ.

–ê–ù–ê–õ–ò–ó –†–´–ù–ö–ê:
${summary}

–ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞–π —Ç–æ—Ä–≥–æ–≤—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è ${symbol}.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑–∞ –æ–±—ä–µ–º–æ–≤
2. –û–ø—Ä–µ–¥–µ–ª–∏ —á–µ—Ç–∫–∏–µ —É—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞ (LONG/SHORT)
3. –£—Å—Ç–∞–Ω–æ–≤–∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç –º–∏–Ω–∏–º—É–º +2% –æ—Ç –≤—Ö–æ–¥–∞
4. –£—Å—Ç–∞–Ω–æ–≤–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å –º–∞–∫—Å–∏–º—É–º -1.5% –æ—Ç –≤—Ö–æ–¥–∞
5. –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ä–∏—Å–∫/–ø—Ä–∏–±—ã–ª—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 1:2

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (JSON):
{
  "position": "long" | "short" | "wait",
  "priceOpen": number | undefined,
  "priceTakeProfit": number,
  "priceStopLoss": number,
  "minuteEstimatedTime": number
}`;
  },
});

// –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
listenOptimizerProgress((event) => {
  const percent = (event.progress * 100).toFixed(1);
  console.log(`[${percent}%] ${event.comment}`);
});

// –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
console.log("–ó–∞–ø—É—Å–∫ AI –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π...\n");

await Optimizer.dump("BTCUSDT", {
  optimizerName: "advanced-crypto-optimizer",
});

console.log("\n‚úì –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!");
console.log("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª: ./dump/optimizer/advanced-crypto-optimizer_BTCUSDT.mjs");
console.log("\n–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:");
console.log("node ./dump/optimizer/advanced-crypto-optimizer_BTCUSDT.mjs");
```

---

## –ó–∞–ø—É—Å–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```bash
# –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª
node ./dump/optimizer/advanced-crypto-optimizer_BTCUSDT.mjs

# –í—ã–≤–æ–¥:
# –ó–∞–ø—É—Å–∫ Walker –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π...
# [10.0%] –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ advanced-crypto-optimizer-strategy-1
# [20.0%] –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ advanced-crypto-optimizer-strategy-2
# [30.0%] –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ advanced-crypto-optimizer-strategy-3
# ...
# [100%] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
# –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: ./dump/walker/advanced-crypto-optimizer_walker.md
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

```typescript
// –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏—è
OLLAMA_MODEL=llama3

// –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
OLLAMA_MODEL=deepseek-v3.1

// –î–ª—è –±–∞–ª–∞–Ω—Å–∞—Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞
OLLAMA_MODEL=mistral
```

### 2. –†–∞–∑–º–µ—Ä –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

```typescript
// –ú–∏–Ω–∏–º—É–º 2 –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –æ–±—É—á–µ–Ω–∏—è
rangeTrain: [
  { startDate: new Date("2025-01-01"), endDate: new Date("2025-01-15") },
  { startDate: new Date("2025-02-01"), endDate: new Date("2025-02-15") },
]

// –û–ø—Ç–∏–º–∞–ª—å–Ω–æ 3-5 –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
rangeTrain: [
  // –Ø–Ω–≤–∞—Ä—å
  // –§–µ–≤—Ä–∞–ª—å
  // –ú–∞—Ä—Ç
  // –ê–ø—Ä–µ–ª—å
  // –ú–∞–π
]
```

### 3. –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–ø—Ç–æ–≤

```typescript
// –ü–ª–æ—Ö–æ–π –ø—Ä–æ–º–ø—Ç
getPrompt: async (symbol, messages) => {
  return "–°–æ–∑–¥–∞–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—é";
}

// –•–æ—Ä–æ—à–∏–π –ø—Ä–æ–º–ø—Ç
getPrompt: async (symbol, messages) => {
  return `–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ç–æ—Ä–≥–æ–≤–ª–µ ${symbol}.

–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞: ${summary}

–°–æ–∑–¥–∞–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏:
- –ß–µ—Ç–∫–∏–µ —É—Å–ª–æ–≤–∏—è –≤—Ö–æ–¥–∞
- TP –º–∏–Ω–∏–º—É–º +2%
- SL –º–∞–∫—Å–∏–º—É–º -1.5%
- –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ R/R –º–∏–Ω–∏–º—É–º 1:2

–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON...`;
}
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ Optimizer –≤ backtest-kit –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI. –ö–æ–º–±–∏–Ω–∏—Ä—É—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –º—É–ª—å—Ç–∏—Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ LLM –º–æ–¥–µ–ª–∏, –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

1. **[LLM –¢—Ä–µ–π–¥–∏–Ω–≥ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º JSON –≤—ã–≤–æ–¥–æ–º](07-llm-trading.md)** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LLM –∫–∞–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
